# CODITECT Staging Environment - Terraform Variables
# Copy this file to terraform.tfvars and customize values
# DO NOT commit terraform.tfvars to git (contains sensitive data)

# ============================================================================
# GCP Project Configuration
# ============================================================================

project_id = "coditect-staging"
project_name = "CODITECT Staging"
region = "us-central1"
zone = "us-central1-a"

regions = ["us-central1", "us-east1"]  # Multi-region for staging

# ============================================================================
# Environment Configuration
# ============================================================================

environment = "staging"
labels = {
  environment = "staging"
  project     = "coditect"
  managed_by  = "terraform"
  team        = "platform"
}

# ============================================================================
# GKE Cluster Configuration
# ============================================================================

gke_cluster_name = "coditect-gke-staging"
gke_cluster_version = "1.28"

gke_node_pools = {
  default = {
    machine_type   = "n2-standard-4"  # Larger than dev
    min_nodes      = 2
    max_nodes      = 10
    disk_size_gb   = 100
    disk_type      = "pd-ssd"
    preemptible    = false  # No preemptible for staging
    auto_repair    = true
    auto_upgrade   = true
  }
}

gke_enable_private_nodes     = true
gke_enable_private_endpoint  = true  # Private endpoint for staging
gke_master_ipv4_cidr         = "172.16.0.0/28"
gke_enable_workload_identity = true
gke_enable_vertical_pod_autoscaling = true

# ============================================================================
# Networking Configuration
# ============================================================================

vpc_name = "coditect-vpc-staging"
subnet_name = "gke-subnet-staging"
subnet_cidr = "10.10.0.0/20"

pods_cidr_range = "10.11.0.0/16"
services_cidr_range = "10.12.0.0/16"

db_subnet_name = "db-subnet-staging"
db_subnet_cidr = "10.10.16.0/24"

redis_subnet_name = "redis-subnet-staging"
redis_subnet_cidr = "10.10.17.0/24"

# ============================================================================
# Cloud SQL (PostgreSQL) Configuration
# ============================================================================

cloudsql_instance_name = "coditect-postgres-staging"
cloudsql_database_version = "POSTGRES_15"
cloudsql_tier = "db-custom-4-16384"  # 4 vCPU, 16GB RAM (production-like)
cloudsql_disk_size = 100  # GB
cloudsql_disk_type = "PD_SSD"
cloudsql_availability_type = "REGIONAL"  # HA for staging

cloudsql_backup_enabled = true
cloudsql_backup_start_time = "03:00"
cloudsql_point_in_time_recovery = true

# ============================================================================
# Redis Configuration
# ============================================================================

redis_instance_name = "coditect-redis-staging"
redis_tier = "STANDARD_HA"  # HA for staging
redis_memory_size_gb = 5
redis_version = "REDIS_7_0"

# ============================================================================
# Service Accounts
# ============================================================================

terraform_sa_email = "terraform-sa@coditect-staging.iam.gserviceaccount.com"
gke_sa_email = "gke-sa@coditect-staging.iam.gserviceaccount.com"
django_app_sa_email = "django-app-sa@coditect-staging.iam.gserviceaccount.com"

# ============================================================================
# Secrets Configuration
# ============================================================================

secrets = [
  "django-secret-key",
  "db-password",
  "stripe-api-key",
  "oauth-client-secret"
]

# ============================================================================
# Storage Configuration
# ============================================================================

gcs_buckets = {
  static = {
    name          = "coditect-staging-static"
    location      = "US"
    storage_class = "STANDARD"
    versioning    = true
  }
  media = {
    name          = "coditect-staging-media"
    location      = "US"
    storage_class = "STANDARD"
    versioning    = true
  }
  backups = {
    name          = "coditect-staging-backups"
    location      = "US"
    storage_class = "NEARLINE"
    versioning    = true
  }
}

# ============================================================================
# Monitoring Configuration
# ============================================================================

enable_monitoring = true
enable_logging = true
log_retention_days = 90  # 90 days for staging

enable_prometheus = true
prometheus_storage_size = "50Gi"

enable_grafana = true
enable_jaeger = true

# ============================================================================
# Security Configuration
# ============================================================================

allowed_ssh_sources = ["10.0.0.0/8"]  # Internal only
allowed_https_sources = ["0.0.0.0/0"]

enable_network_policies = true
enable_binary_authorization = true  # Enable for staging

# ============================================================================
# Cost Management
# ============================================================================

budget_amount = 2000  # USD per month
budget_alert_thresholds = [0.5, 0.9, 1.0]

max_nodes_per_zone = 15

# ============================================================================
# Feature Flags
# ============================================================================

enable_auto_scaling = true
enable_cluster_autoscaling = true
enable_vertical_pod_autoscaling = true
enable_maintenance_window = true

maintenance_window_day = "sunday"
maintenance_window_start_time = "04:00"
maintenance_window_duration = "4h"

# ============================================================================
# Application Configuration
# ============================================================================

django_image_tag = "staging"
django_replicas = 3
django_resources = {
  requests = {
    cpu    = "1000m"
    memory = "1Gi"
  }
  limits = {
    cpu    = "2000m"
    memory = "2Gi"
  }
}

celery_replicas = 2
celery_resources = {
  requests = {
    cpu    = "500m"
    memory = "512Mi"
  }
  limits = {
    cpu    = "1000m"
    memory = "1Gi"
  }
}
